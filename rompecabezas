<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Rompecabezas de Hielo</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: linear-gradient(#b3e5fc, #e1f5fe);
    text-align: center;
}

.screen {
    padding: 20px;
}

input {
    padding: 10px;
    font-size: 16px;
    width: 80%;
    max-width: 300px;
}

button {
    padding: 10px 20px;
    font-size: 16px;
    background: #0288d1;
    color: #fff;
    border: none;
    border-radius: 6px;
    margin-top: 10px;
}

#puzzle {
    display: grid;
    gap: 2px;
    margin: 20px auto;
}

.tile {
    width: 80px;
    height: 80px;
    background-size: cover;
    cursor: pointer;
}

.hidden {
    display: none;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login" class="screen">
    <h1>❄️ Rompecabezas de Hielo ❄️</h1>
    <p>Ingresá tu nombre para jugar</p>
    <input id="nameInput" placeholder="Tu nombre">
    <br>
    <button onclick="startGame()">Entrar</button>
</div>

<!-- JUEGO -->
<div id="game" class="screen hidden">
    <h2 id="playerName"></h2>
    <p>Nivel: <span id="level"></span> | Puzzle: <span id="puzzleCount"></span>/200</p>
    <div id="puzzle"></div>
    <button onclick="nextPuzzle()">Siguiente rompecabezas</button>
</div>

<script>
/* =========================
   CONFIGURACIÓN
========================= */

// 10 imágenes x 20 variaciones = 200 puzzles
const IMAGES = [
    "https://images.unsplash.com/photo-1482192596544-9eb780fc7f66",
    "https://images.unsplash.com/photo-1519681393784-d120267933ba",
    "https://images.unsplash.com/photo-1483729558449-99ef09a8c325",
    "https://images.unsplash.com/photo-1486902197509-7c03c422bb1c",
    "https://images.unsplash.com/photo-1516455207990-7a41ce80f7ee",
    "https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05",
    "https://images.unsplash.com/photo-1484313544071-4d67c88b99be",
    "https://images.unsplash.com/photo-1499346030926-9a72daac6c63",
    "https://images.unsplash.com/photo-1500530855697-b586d89ba3ee",
    "https://images.unsplash.com/photo-1483683804023-6ccdb62f86ef"
];

const TOTAL_PUZZLES = 200;

/* =========================
   ESTADO
========================= */

let player = "";
let level = 1;
let puzzleNumber = 1;
let size = 3;
let tiles = [];
let empty = 0;

/* =========================
   LOGIN
========================= */

function startGame() {
    const name = document.getElementById("nameInput").value.trim();
    if (!name) {
        alert("Ingresá tu nombre");
        return;
    }

    player = name;
    loadPlayer();

    document.getElementById("login").classList.add("hidden");
    document.getElementById("game").classList.remove("hidden");

    document.getElementById("playerName").innerText = "Jugador: " + player;
    loadPuzzle();
}

function loadPlayer() {
    const data = localStorage.getItem("puzzle_" + player);
    if (data) {
        const saved = JSON.parse(data);
        level = saved.level;
        puzzleNumber = saved.puzzle;
    } else {
        savePlayer();
    }
}

function savePlayer() {
    localStorage.setItem("puzzle_" + player, JSON.stringify({
        level: level,
        puzzle: puzzleNumber
    }));
}

/* =========================
   PUZZLE
========================= */

function loadPuzzle() {
    size = Math.min(3 + level - 1, 6);

    const board = document.getElementById("puzzle");
    board.innerHTML = "";
    board.style.gridTemplateColumns = `repeat(${size}, 80px)`;

    tiles = [];
    for (let i = 0; i < size * size; i++) {
        tiles.push(i);
    }

    shuffle(tiles);
    empty = tiles.indexOf(size * size - 1);

    const img = IMAGES[puzzleNumber % IMAGES.length];

    tiles.forEach((val, idx) => {
        const div = document.createElement("div");
        div.className = "tile";

        if (val === size * size - 1) {
            div.style.background = "transparent";
        } else {
            const x = val % size;
            const y = Math.floor(val / size);
            div.style.backgroundImage = `url(${img})`;
            div.style.backgroundPosition = `${(-x * 80)}px ${(-y * 80)}px`;
            div.style.backgroundSize = `${size * 80}px ${size * 80}px`;
        }

        div.onclick = () => moveTile(idx);
        board.appendChild(div);
    });

    document.getElementById("level").innerText = level;
    document.getElementById("puzzleCount").innerText = puzzleNumber;
}

function moveTile(index) {
    const moves = [
        empty - 1,
        empty + 1,
        empty - size,
        empty + size
    ];

    if (!moves.includes(index)) return;

    [tiles[empty], tiles[index]] = [tiles[index], tiles[empty]];
    empty = index;
    redraw();
    checkWin();
}

function redraw() {
    const board = document.getElementById("puzzle").children;
    const img = IMAGES[puzzleNumber % IMAGES.length];

    for (let i = 0; i < tiles.length; i++) {
        if (tiles[i] === size * size - 1) {
            board[i].style.background = "transparent";
        } else {
            const x = tiles[i] % size;
            const y = Math.floor(tiles[i] / size);
            board[i].style.backgroundImage = `url(${img})`;
            board[i].style.backgroundPosition = `${(-x * 80)}px ${(-y * 80)}px`;
            board[i].style.backgroundSize = `${size * 80}px ${size * 80}px`;
        }
    }
}

function checkWin() {
    for (let i = 0; i < tiles.length; i++) {
        if (tiles[i] !== i) return;
    }
    setTimeout(() => alert("❄️ ¡Rompecabezas completado! ❄️"), 200);
}

function nextPuzzle() {
    puzzleNumber++;
    if (puzzleNumber > TOTAL_PUZZLES) puzzleNumber = 1;

    if (puzzleNumber % 10 === 0 && level < 4) {
        level++;
    }

    savePlayer();
    loadPuzzle();
}

function shuffle(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
    }
}
</script>

</body>
</html>
