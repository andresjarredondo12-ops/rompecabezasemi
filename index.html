<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frozen Puzzle - 200 Niveles</title>
    <style>
        :root {
            --frozen-blue: #00d4ff;
            --ice-white: #f0f8ff;
            --gold-bg: linear-gradient(45deg, #bf953f, #fcf6ba, #b38728, #fcf6ba, #aa771c);
        }

        body {
            margin: 0;
            font-family: 'Arial Rounded MT Bold', sans-serif;
            background: #0a192f;
            color: white;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        /* --- PANTALLA INICIAL --- */
        #login-screen {
            text-align: center;
            background: rgba(0, 0, 0, 0.7);
            padding: 40px;
            border-radius: 20px;
            border: 2px solid var(--frozen-blue);
            box-shadow: 0 0 30px var(--frozen-blue);
            z-index: 10;
        }

        input {
            padding: 15px;
            font-size: 1.2rem;
            border-radius: 10px;
            border: none;
            margin: 20px 0;
            width: 80%;
        }

        button {
            padding: 15px 30px;
            font-size: 1.2rem;
            background: var(--frozen-blue);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: 0.3s;
        }

        button:hover { transform: scale(1.1); background: white; color: #0074D9; }

        /* --- ÁREA DE JUEGO --- */
        #game-screen { display: none; flex-direction: column; align-items: center; width: 100%; }

        #puzzle-board {
            width: 500px;
            height: 500px;
            background: rgba(255,255,255,0.1);
            position: relative;
            border: 4px solid var(--frozen-blue);
            margin-top: 20px;
        }

        .piece {
            position: absolute;
            cursor: move;
            border: 1px solid rgba(255,255,255,0.4);
            background-repeat: no-repeat;
            z-index: 5;
        }

        /* --- PANTALLA GANADORA --- */
        #victory-screen {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: var(--gold-bg);
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }

        #victory-text {
            font-size: 3.5rem;
            color: #5d4037;
            text-align: center;
            font-weight: bold;
            text-shadow: 2px 2px 10px rgba(255,255,255,0.5);
            margin-bottom: 30px;
        }

        canvas#particle-canvas {
            position: absolute;
            top: 0; left: 0; pointer-events: none;
        }

        .info-panel { text-align: center; font-size: 1.5rem; margin-bottom: 10px; }
    </style>
</head>
<body>

    <div id="login-screen">
        <h1>FROZEN ADVENTURE</h1>
        <p>Bienvenido al Reino de Hielo</p>
        <input type="text" id="username" placeholder="Tu Nombre Aquí...">
        <br>
        <button onclick="initPlayer()">COMENZAR PARTIDA</button>
    </div>

    <div id="game-screen">
        <div class="info-panel">
            <div id="user-name-display"></div>
            <div>Nivel: <span id="level-num">1</span> / 200</div>
        </div>
        <div id="puzzle-board"></div>
    </div>

    <div id="victory-screen">
        <canvas id="particle-canvas"></canvas>
        <h1 id="victory-text"></h1>
        <button onclick="loadNextLevel()" style="background:#5d4037">SIGUIENTE NIVEL</button>
    </div>

    <script>
        let user = "";
        let level = 1;
        const board = document.getElementById('puzzle-board');
        const db_key = "frozen_game_data_2026";

        // Imágenes estables de Frozen
        const frozenImages = [
            "https://wallpaperaccess.com/full/1595180.jpg",
            "https://wallpaperaccess.com/full/1595182.jpg",
            "https://wallpaperaccess.com/full/192271.jpg",
            "https://wallpaperaccess.com/full/192283.jpg",
            "https://wallpaperaccess.com/full/1595208.jpg"
        ];

        function initPlayer() {
            const inputName = document.getElementById('username').value;
            if (!inputName) return alert("Por favor, ingresa tu nombre");
            
            user = inputName;
            let storage = JSON.parse(localStorage.getItem(db_key)) || {};
            
            if (storage[user]) {
                level = storage[user].level;
            } else {
                level = 1;
                storage[user] = { level: 1 };
                localStorage.setItem(db_key, JSON.stringify(storage));
            }

            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('game-screen').style.display = 'flex';
            setupGame();
        }

        function setupGame() {
            board.innerHTML = "";
            document.getElementById('user-name-display').innerText = "Jugador: " + user;
            document.getElementById('level-num').innerText = level;

            // Dificultad: empieza 2x2, escala cada 10 niveles
            let size = 2 + Math.floor(level / 10);
            if (size > 8) size = 8; // Máximo 8x8 para que sea jugable

            const imgUrl = frozenImages[(level - 1) % frozenImages.length];
            const pWidth = 500 / size;
            const pHeight = 500 / size;

            for (let r = 0; r < size; r++) {
                for (let c = 0; c < size; c++) {
                    const piece = document.createElement('div');
                    piece.className = 'piece';
                    piece.style.width = pWidth + 'px';
                    piece.style.height = pHeight + 'px';
                    piece.style.backgroundImage = `url('${imgUrl}')`;
                    piece.style.backgroundSize = "500px 500px";
                    piece.style.backgroundPosition = `-${c * pWidth}px -${r * pHeight}px`;
                    
                    // Guardar posición correcta
                    piece.dataset.correctX = c * pWidth;
                    piece.dataset.correctY = r * pHeight;

                    // Posición inicial aleatoria fuera del tablero (zona de piezas)
                    piece.style.left = (Math.random() * (window.innerWidth - pWidth)) + 'px';
                    piece.style.top = (Math.random() * (window.innerHeight - pHeight)) + 'px';

                    addDragLogic(piece);
                    document.body.appendChild(piece);
                }
            }
        }

        function addDragLogic(el) {
            let isDragging = false;
            let offX, offY;

            el.onmousedown = (e) => {
                isDragging = true;
                offX = e.clientX - el.offsetLeft;
                offY = e.clientY - el.offsetTop;
                el.style.zIndex = 1000;
            };

            document.onmousemove = (e) => {
                if (!isDragging) return;
                el.style.left = (e.clientX - offX) + 'px';
                el.style.top = (e.clientY - offY) + 'px';
            };

            document.onmouseup = () => {
                if (!isDragging) return;
                isDragging = false;
                
                const boardRect = board.getBoundingClientRect();
                const currentX = parseFloat(el.style.left) - boardRect.left;
                const currentY = parseFloat(el.style.top) - boardRect.top;
                const targetX = parseFloat(el.dataset.correctX);
                const targetY = parseFloat(el.dataset.correctY);

                // Si está cerca del lugar correcto (margen de 30px)
                if (Math.abs(currentX - targetX) < 30 && Math.abs(currentY - targetY) < 30) {
                    el.style.left = (boardRect.left + targetX) + 'px';
                    el.style.top = (boardRect.top + targetY) + 'px';
                    el.classList.add('placed');
                    el.style.zIndex = 1;
                    el.onmousedown = null; // Bloquear pieza en su lugar
                    checkWin();
                }
            };
        }

        function checkWin() {
            const total = document.querySelectorAll('.piece').length;
            const placed = document.querySelectorAll('.placed').length;
            if (total > 0 && total === placed) {
                showVictory();
            }
        }

        function showVictory() {
            const vText = document.getElementById('victory-text');
            vText.innerText = `¡¡¡FELICIDADES GANASTE ${user.toUpperCase()}!!!`;
            document.getElementById('victory-screen').style.display = 'flex';
            
            // Actualizar nivel en "Base de Datos"
            level++;
            let storage = JSON.parse(localStorage.getItem(db_key));
            storage[user].level = level;
            localStorage.setItem(db_key, JSON.stringify(storage));

            startParticles();
        }

        function loadNextLevel() {
            location.reload(); // Recarga para limpiar piezas y cargar nuevo nivel
        }

        // --- EFECTOS DE CORAZONES Y ESTRELLAS ---
        function startParticles() {
            const canvas = document.getElementById('particle-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            const particles = [];
            for(let i=0; i<100; i++) {
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    size: Math.random() * 20 + 10,
                    speed: Math.random() * 3 + 1,
                    type: Math.random() > 0.4 ? 'heart' : 'star',
                    color: ['#ff4d6d', '#ff0000', '#00d4ff'][Math.floor(Math.random() * 3)]
                });
            }

            function draw() {
                ctx.clearRect(0,0, canvas.width, canvas.height);
                particles.forEach(p => {
                    ctx.fillStyle = p.color;
                    if(p.type === 'heart') {
                        ctx.beginPath();
                        ctx.arc(p.x, p.y, p.size/2, Math.PI, 0);
                        ctx.arc(p.x + p.size/2, p.y, p.size/2, Math.PI, 0);
                        ctx.lineTo(p.x + p.size/2, p.y + p.size);
                        ctx.lineTo(p.x - p.size/2, p.y);
                        ctx.fill();
                    } else {
                        // Estrella simple
                        ctx.font = p.size + "px Arial";
                        ctx.fillText("★", p.x, p.y);
                    }
                    p.y += p.speed;
                    if(p.y > canvas.height) p.y = -20;
                });
                requestAnimationFrame(draw);
            }
            draw();
        }
    </script>
</body>
</html>






