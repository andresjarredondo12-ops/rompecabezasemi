<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frozen Puzzle Adventure - 200 Niveles</title>
    <style>
        :root {
            --frozen-blue: #00d4ff;
            --gold: #ffd700;
        }

        body {
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a2e;
            color: white;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #login-screen, #game-screen, #victory-screen {
            display: none;
            width: 100vw;
            height: 100vh;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: absolute;
        }

        /* Pantalla de Inicio */
        #login-screen { display: flex; background: linear-gradient(45deg, #001f3f, #0074D9); }
        input { padding: 15px; border-radius: 25px; border: none; width: 250px; font-size: 1.1rem; margin-bottom: 20px; }
        button { padding: 15px 40px; border-radius: 25px; border: none; background: var(--frozen-blue); color: white; cursor: pointer; font-weight: bold; transition: 0.3s; }
        button:hover { transform: scale(1.1); background: #fff; color: var(--frozen-blue); }

        /* Área de Juego */
        #puzzle-container {
            position: relative;
            width: 500px;
            height: 500px;
            background: rgba(255,255,255,0.1);
            border: 3px solid var(--frozen-blue);
            box-shadow: 0 0 20px var(--frozen-blue);
        }

        .piece {
            position: absolute;
            cursor: grab;
            border: 1px solid rgba(255,255,255,0.3);
            box-sizing: border-box;
        }

        .piece:active { cursor: grabbing; z-index: 100; }

        /* Pantalla de Victoria */
        #victory-screen {
            background: linear-gradient(45deg, #bf953f, #fcf6ba, #b38728, #fcf6ba, #aa771c);
            z-index: 1000;
        }

        #victory-screen h1 {
            font-size: 3rem;
            color: #5d4037;
            text-shadow: 2px 2px 5px rgba(0,0,0,0.2);
            text-align: center;
            padding: 20px;
        }

        canvas#celebration-canvas {
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none;
        }

        #ui-layer { margin-bottom: 10px; text-align: center; }
    </style>
</head>
<body>

    <div id="login-screen">
        <h1>FROZEN PUZZLE</h1>
        <p>Ingresa tu nombre para comenzar la aventura</p>
        <input type="text" id="username" placeholder="Nombre de usuario...">
        <button onclick="startGame()">ENTRAR</button>
    </div>

    <div id="game-screen">
        <div id="ui-layer">
            <h2 id="display-user"></h2>
            <h3>Nivel: <span id="display-level">1</span> / 200</h3>
        </div>
        <div id="puzzle-container"></div>
    </div>

    <div id="victory-screen">
        <canvas id="celebration-canvas"></canvas>
        <h1 id="victory-text"></h1>
        <button onclick="nextLevel()">SIGUIENTE NIVEL</button>
    </div>

    <script>
        let currentUser = "";
        let currentLevel = 1;
        let pieces = [];
        let rows = 2, cols = 2; // Empieza fácil
        const container = document.getElementById('puzzle-container');
        const canvas = document.getElementById('celebration-canvas');
        const ctx = canvas.getContext('2d');

        // Imágenes temáticas de Frozen para los niveles
        const images = [
            'https://images.alphacoders.com/105/1052639.jpg',
            'https://images.alphacoders.com/105/1055018.jpg',
            'https://images.alphacoders.com/469/469145.jpg',
            'https://images.alphacoders.com/605/605151.jpg'
        ];

        function startGame() {
            const input = document.getElementById('username').value;
            if (!input) return alert("Escribe tu nombre");
            
            currentUser = input;
            // "Base de datos" en LocalStorage
            const savedData = JSON.parse(localStorage.getItem('frozen_puzzles_db')) || {};
            if (savedData[currentUser]) {
                currentLevel = savedData[currentUser].level;
            } else {
                currentLevel = 1;
                savedData[currentUser] = { level: 1 };
                localStorage.setItem('frozen_puzzles_db', JSON.stringify(savedData));
            }

            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('game-screen').style.display = 'flex';
            initLevel();
        }

        function initLevel() {
            container.innerHTML = "";
            document.getElementById('display-user').innerText = `Jugador: ${currentUser}`;
            document.getElementById('display-level').innerText = currentLevel;
            
            // Aumentar dificultad cada 5 niveles
            cols = 2 + Math.floor(currentLevel / 10);
            rows = 2 + Math.floor(currentLevel / 10);
            
            const imgUrl = images[currentLevel % images.length];
            const pieceWidth = 500 / cols;
            const pieceHeight = 500 / rows;

            pieces = [];

            for (let r = 0; r < rows; r++) {
                for (let c = 0; c < cols; c++) {
                    const piece = document.createElement('div');
                    piece.className = 'piece';
                    piece.style.width = pieceWidth + 'px';
                    piece.style.height = pieceHeight + 'px';
                    piece.style.backgroundImage = `url(${imgUrl})`;
                    piece.style.backgroundSize = `500px 500px`;
                    piece.style.backgroundPosition = `-${c * pieceWidth}px -${r * pieceHeight}px`;
                    
                    // Posición inicial aleatoria (desordenado)
                    const startX = Math.random() * (window.innerWidth - pieceWidth);
                    const startY = Math.random() * (window.innerHeight - pieceHeight);
                    
                    piece.style.left = startX + 'px';
                    piece.style.top = startY + 'px';

                    // Datos de destino
                    piece.dataset.correctX = c * pieceWidth;
                    piece.dataset.correctY = r * pieceHeight;
                    
                    makeDraggable(piece);
                    container.appendChild(piece);
                    pieces.push(piece);
                }
            }
        }

        function makeDraggable(el) {
            let isDragging = false;
            let offset = { x: 0, y: 0 };

            el.addEventListener('mousedown', (e) => {
                isDragging = true;
                const rect = el.getBoundingClientRect();
                offset.x = e.clientX - rect.left;
                offset.y = e.clientY - rect.top;
                el.style.zIndex = 1000;
            });

            document.addEventListener('mousemove', (e) => {
                if (!isDragging) return;
                el.style.left = (e.clientX - offset.x) + 'px';
                el.style.top = (e.clientY - offset.y) + 'px';
            });

            document.addEventListener('mouseup', () => {
                if (!isDragging) return;
                isDragging = false;
                checkPiece(el);
            });
        }

        function checkPiece(el) {
            const containerRect = container.getBoundingClientRect();
            const currentX = parseFloat(el.style.left) - containerRect.left;
            const currentY = parseFloat(el.style.top) - containerRect.top;
            
            const targetX = parseFloat(el.dataset.correctX);
            const targetY = parseFloat(el.dataset.correctY);

            // Si está cerca del lugar correcto (margen de 20px), encajar
            if (Math.abs(currentX - targetX) < 25 && Math.abs(currentY - targetY) < 25) {
                el.style.left = (containerRect.left + targetX) + 'px';
                el.style.top = (containerRect.top + targetY) + 'px';
                el.classList.add('locked');
                checkWin();
            }
        }

        function checkWin() {
            const locked = document.querySelectorAll('.locked').length;
            if (locked === pieces.length) {
                showVictory();
            }
        }

        // --- EFECTOS DE VICTORIA ---
        let particles = [];
        function showVictory() {
            document.getElementById('victory-text').innerText = `¡¡¡FELICIDADES GANASTE ${currentUser.toUpperCase()}!!!`;
            document.getElementById('victory-screen').style.display = 'flex';
            
            // Guardar progreso
            currentLevel++;
            const savedData = JSON.parse(localStorage.getItem('frozen_puzzles_db'));
            savedData[currentUser].level = currentLevel;
            localStorage.setItem('frozen_puzzles_db', JSON.stringify(savedData));

            // Iniciar lluvia
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            createParticles();
            animateParticles();
        }

        function createParticles() {
            particles = [];
            for (let i = 0; i < 150; i++) {
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height - canvas.height,
                    type: Math.random() > 0.5 ? 'heart' : 'star',
                    color: ['#ff4d6d', '#ff0000', '#00d4ff'][Math.floor(Math.random() * 3)],
                    size: Math.random() * 15 + 10,
                    speed: Math.random() * 3 + 2
                });
            }
        }

        function drawHeart(x, y, size, color) {
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.bezierCurveTo(x, y - size/2, x - size, y - size/2, x - size, y);
            ctx.bezierCurveTo(x - size, y + size/2, x, y + size, x, y + size);
            ctx.bezierCurveTo(x, y + size, x + size, y + size/2, x + size, y);
            ctx.bezierCurveTo(x + size, y - size/2, x, y - size/2, x, y);
            ctx.fill();
        }

        function drawStar(x, y, size, color) {
            ctx.fillStyle = color;
            ctx.beginPath();
            for (let i = 0; i < 5; i++) {
                ctx.lineTo(Math.cos((18 + i * 72) * Math.PI / 180) * size + x,
                           Math.sin((18 + i * 72) * Math.PI / 180) * size + y);
                ctx.lineTo(Math.cos((54 + i * 72) * Math.PI / 180) * (size/2) + x,
                           Math.sin((54 + i * 72) * Math.PI / 180) * (size/2) + y);
            }
            ctx.closePath();
            ctx.fill();
        }

        function animateParticles() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            particles.forEach(p => {
                if (p.type === 'heart') drawHeart(p.x, p.y, p.size, p.color);
                else drawStar(p.x, p.y, p.size, p.color);
                p.y += p.speed;
                if (p.y > canvas.height) p.y = -20;
            });
            if (document.getElementById('victory-screen').style.display === 'flex') {
                requestAnimationFrame(animateParticles);
            }
        }

        function nextLevel() {
            document.getElementById('victory-screen').style.display = 'none';
            initLevel();
        }
    </script>
</body>
</html>





