<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Rompecabezas de Animales</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
    margin:0;
    font-family:Arial, sans-serif;
    background:linear-gradient(#b3e5ff,#ffffff);
    overflow:hidden;
}

/* PANTALLA INICIO */
#startScreen{
    position:fixed;
    inset:0;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
}

#startScreen input{
    padding:12px;
    font-size:18px;
    margin-top:10px;
}

#startScreen button{
    margin-top:15px;
    padding:12px 25px;
    font-size:18px;
}

/* JUEGO */
#game{
    display:none;
    padding:10px;
}

#topBar{
    display:flex;
    justify-content:space-between;
    font-size:18px;
}

#puzzleContainer{
    position:relative;
    width:300px;
    height:300px;
    margin:20px auto;
    border:4px solid #2196f3;
    background-size:cover;
    background-position:center;
    touch-action:none;
}

.piece{
    position:absolute;
    width:100px;
    height:100px;
    background-size:300px 300px;
    cursor:grab;
    border:1px solid #fff;
    touch-action:none;
}

/* PANTALLA GANADORA */
#winScreen{
    position:fixed;
    inset:0;
    background:radial-gradient(circle at top,#1a237e,#000);
    display:none;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    z-index:10;
    color:white;
    text-align:center;
    overflow:hidden;
}

#winScreen h1{
    font-size:30px;
    margin-bottom:20px;
    z-index:2;
}

#winScreen button{
    padding:14px 30px;
    font-size:18px;
    cursor:pointer;
    border:none;
    background:white;
    color:#1a237e;
    border-radius:6px;
    z-index:2;
}

/* PARTICULAS */
.particle{
    position:fixed;
    top:-30px;
    font-size:24px;
    animation:fall linear forwards;
    pointer-events:none;
}

@keyframes fall{
    to{
        transform:translateY(120vh) translateX(50px);
        opacity:0;
    }
}
</style>
</head>

<body>

<!-- INICIO -->
<div id="startScreen">
    <h1>üß© Rompecabezas de Animales üêæ</h1>
    <input type="text" id="usernameInput" placeholder="Tu nombre">
    <button onclick="startGame()">Jugar</button>
</div>

<!-- JUEGO -->
<div id="game">
    <div id="topBar">
        <div>Jugador: <b id="playerName"></b></div>
        <div>Nivel: <b id="level"></b> / 200</div>
    </div>
    <div id="puzzleContainer"></div>
</div>

<!-- GANASTE -->
<div id="winScreen">
    <h1 id="winText"></h1>
    <button onclick="nextLevel()">Pr√≥xima partida</button>
</div>

<script>
/* ================= IM√ÅGENES ANIMALES ================= */
const baseImages=[
    "https://images.unsplash.com/photo-1518717758536-85ae29035b6d",
    "https://images.unsplash.com/photo-1518791841217-8f162f1e1131",
    "https://images.unsplash.com/photo-1501706362039-c6e80948a59a",
    "https://images.unsplash.com/photo-1500530855697-b586d89ba3ee",
    "https://images.unsplash.com/photo-1504208434309-cb69f4fe52b0"
];

const images=[];
for(let i=0;i<200;i++){
    images.push(baseImages[i % baseImages.length]);
}

const size=3;
let currentLevel=0;
let pieces=[];
let username="";
let activePiece=null;
let offsetX=0;
let offsetY=0;

/* ================= INICIO ================= */
function startGame(){
    const input=document.getElementById("usernameInput");
    if(!input.value.trim()){
        alert("Ingres√° tu nombre");
        return;
    }

    username=input.value.trim();
    document.getElementById("playerName").textContent=username;

    const saved=localStorage.getItem("animal_level_"+username);
    if(saved) currentLevel=parseInt(saved);

    document.getElementById("startScreen").style.display="none";
    document.getElementById("game").style.display="block";

    loadLevel();
}

/* ================= NIVEL ================= */
function loadLevel(){
    const container=document.getElementById("puzzleContainer");
    container.innerHTML="";
    pieces=[];

    const img=images[currentLevel];
    container.style.backgroundImage=`url(${img})`;

    for(let y=0;y<size;y++){
        for(let x=0;x<size;x++){
            const p=document.createElement("div");
            p.className="piece";
            p.style.backgroundImage=`url(${img})`;
            p.style.backgroundPosition=`-${x*100}px -${y*100}px`;
            p.dataset.correctX=x*100;
            p.dataset.correctY=y*100;
            p.style.left=Math.random()*200+"px";
            p.style.top=Math.random()*200+"px";

            enableDrag(p);
            container.appendChild(p);
            pieces.push(p);
        }
    }

    document.getElementById("level").textContent=currentLevel+1;
}

/* ================= DRAG T√ÅCTIL + MOUSE ================= */
function enableDrag(el){
    el.addEventListener("pointerdown",e=>{
        activePiece=el;
        offsetX=e.clientX-el.offsetLeft;
        offsetY=e.clientY-el.offsetTop;
        el.setPointerCapture(e.pointerId);
    });

    el.addEventListener("pointermove",e=>{
        if(!activePiece) return;
        activePiece.style.left=(e.clientX-offsetX-puzzleContainer.offsetLeft)+"px";
        activePiece.style.top =(e.clientY-offsetY-puzzleContainer.offsetTop)+"px";
    });

    el.addEventListener("pointerup",()=>{
        activePiece=null;
        checkWin();
    });
}

/* ================= CHECK ================= */
function checkWin(){
    let ok=true;
    pieces.forEach(p=>{
        if(
            Math.abs(parseInt(p.style.left)-p.dataset.correctX)>10 ||
            Math.abs(parseInt(p.style.top)-p.dataset.correctY)>10
        ) ok=false;
    });

    if(ok) showWin();
}

/* ================= GANASTE ================= */
function showWin(){
    document.getElementById("winText").textContent=
        `‚ú® FELICIDADES ${username} GANASTE!!!!! ‚ú®`;

    document.getElementById("winScreen").style.display="flex";
    startParticles();
}

/* ================= SIGUIENTE ================= */
function nextLevel(){
    document.getElementById("winScreen").style.display="none";
    currentLevel++;
    if(currentLevel>=200) currentLevel=0;
    localStorage.setItem("animal_level_"+username,currentLevel);
    loadLevel();
}

/* ================= PARTICULAS ================= */
function startParticles(){
    for(let i=0;i<60;i++){
        const el=document.createElement("div");
        el.className="particle";
        el.style.left=Math.random()*100+"vw";
        el.style.animationDuration=(2+Math.random()*3)+"s";
        el.textContent=Math.random()>0.5?"‚≠ê":"üíó";
        document.body.appendChild(el);
        setTimeout(()=>el.remove(),5000);
    }
}
</script>

</body>
</html>














