<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Frozen Puzzle - 200 Niveles</title>

<style>
:root {
    --frozen-blue: #00d4ff;
    --ice-white: #f0f8ff;
    --gold-bg: linear-gradient(45deg, #bf953f, #fcf6ba, #b38728, #fcf6ba, #aa771c);
}

body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #0a192f;
    color: white;
    overflow: hidden;
}

#login-screen {
    text-align: center;
    background: rgba(0,0,0,.7);
    padding: 40px;
    border-radius: 20px;
    border: 2px solid var(--frozen-blue);
    box-shadow: 0 0 30px var(--frozen-blue);
}

input, button {
    padding: 15px;
    font-size: 1.2rem;
    border-radius: 10px;
    border: none;
    margin-top: 15px;
}

button {
    background: var(--frozen-blue);
    color: white;
    cursor: pointer;
}

#game-screen {
    display: none;
    flex-direction: column;
    align-items: center;
}

#puzzle-board {
    width: 500px;
    height: 500px;
    position: relative;
    margin-top: 20px;
    border: 4px solid var(--frozen-blue);
}

.piece {
    position: absolute;
    cursor: grab;
    background-repeat: no-repeat;
}

#victory-screen {
    display: none;
    position: fixed;
    inset: 0;
    background: var(--gold-bg);
    z-index: 100;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}

#victory-text {
    font-size: 3rem;
    color: #5d4037;
}

canvas {
    position: absolute;
    inset: 0;
    pointer-events: none;
}
</style>
</head>

<body>

<div id="login-screen">
    <h1>‚ùÑÔ∏è FROZEN ADVENTURE ‚ùÑÔ∏è</h1>
    <input id="username" placeholder="Tu nombre">
    <br>
    <button onclick="initPlayer()">COMENZAR</button>
</div>

<div id="game-screen">
    <h2 id="user-name"></h2>
    <h3>Nivel <span id="level-num">1</span> / 200</h3>
    <div id="puzzle-board"></div>
</div>

<div id="victory-screen">
    <canvas id="particle-canvas"></canvas>
    <h1 id="victory-text"></h1>
    <button onclick="nextLevel()">SIGUIENTE NIVEL</button>
</div>

<script>
let user = "";
let level = 1;
const dbKey = "frozen_progress";
const board = document.getElementById("puzzle-board");

/* IM√ÅGENES REALES DE FROZEN */
const frozenImages = [
    "https://wallpaperaccess.com/full/1595180.jpg", // Elsa
    "https://wallpaperaccess.com/full/1595182.jpg", // Anna
    "https://wallpaperaccess.com/full/192271.jpg",  // Olaf
    "https://wallpaperaccess.com/full/192283.jpg",
    "https://wallpaperaccess.com/full/1595208.jpg"
];

function initPlayer() {
    user = username.value.trim();
    if (!user) return alert("Ingres√° tu nombre");

    let db = JSON.parse(localStorage.getItem(dbKey)) || {};
    if (db[user]) level = db[user];
    else db[user] = 1;

    localStorage.setItem(dbKey, JSON.stringify(db));

    login-screen.style.display = "none";
    game-screen.style.display = "flex";

    document.getElementById("user-name").innerText = "Jugador: " + user;
    loadLevel();
}

function loadLevel() {
    board.innerHTML = "";
    document.getElementById("level-num").innerText = level;

    let size = Math.min(2 + Math.floor(level / 10), 8);
    const img = frozenImages[(level - 1) % frozenImages.length];
    const pieceSize = 500 / size;

    let positions = [];
    for (let y = 0; y < size; y++) {
        for (let x = 0; x < size; x++) {
            positions.push({x,y});
        }
    }
    positions.sort(() => Math.random() - 0.5);

    let index = 0;
    for (let y = 0; y < size; y++) {
        for (let x = 0; x < size; x++) {
            const piece = document.createElement("div");
            piece.className = "piece";
            piece.style.width = pieceSize + "px";
            piece.style.height = pieceSize + "px";
            piece.style.backgroundImage = `url(${img})`;
            piece.style.backgroundSize = "500px 500px";
            piece.style.backgroundPosition = `-${x*pieceSize}px -${y*pieceSize}px`;

            piece.dataset.cx = x * pieceSize;
            piece.dataset.cy = y * pieceSize;

            piece.style.left = positions[index].x * pieceSize + "px";
            piece.style.top = positions[index].y * pieceSize + "px";

            drag(piece);
            board.appendChild(piece);
            index++;
        }
    }
}

function drag(el) {
    let dx, dy, dragging = false;

    el.onmousedown = e => {
        dragging = true;
        dx = e.offsetX;
        dy = e.offsetY;
        el.style.zIndex = 10;
    };

    document.onmousemove = e => {
        if (!dragging) return;
        el.style.left = e.pageX - board.offsetLeft - dx + "px";
        el.style.top = e.pageY - board.offsetTop - dy + "px";
    };

    document.onmouseup = () => {
        if (!dragging) return;
        dragging = false;

        let x = Math.round(parseInt(el.style.left) / (500 / Math.sqrt(board.children.length)));
        let y = Math.round(parseInt(el.style.top) / (500 / Math.sqrt(board.children.length)));

        if (Math.abs(el.offsetLeft - el.dataset.cx) < 20 &&
            Math.abs(el.offsetTop - el.dataset.cy) < 20) {

            el.style.left = el.dataset.cx + "px";
            el.style.top = el.dataset.cy + "px";
            el.classList.add("fixed");
            el.onmousedown = null;

            checkWin();
        }
    };
}

function checkWin() {
    if (document.querySelectorAll(".fixed").length === board.children.length) {
        showVictory();
    }
}

function showVictory() {
    document.getElementById("victory-screen").style.display = "flex";
    document.getElementById("victory-text").innerText =
        `üéâ FELICIDADES ${user.toUpperCase()} GANASTE !!! üéâ`;
    startParticles();

    let db = JSON.parse(localStorage.getItem(dbKey));
    db[user] = ++level;
    localStorage.setItem(dbKey, JSON.stringify(db));
}

function nextLevel() {
    document.getElementById("victory-screen").style.display = "none";
    loadLevel();
}

/* EFECTOS */
function startParticles() {
    const canvas = document.getElementById("particle-canvas");
    const ctx = canvas.getContext("2d");
    canvas.width = innerWidth;
    canvas.height = innerHeight;

    let items = Array.from({length:80}, () => ({
        x: Math.random()*canvas.width,
        y: Math.random()*canvas.height,
        s: Math.random()*20+10,
        v: Math.random()*2+1,
        t: Math.random()>0.5?"‚ù§Ô∏è":"‚≠ê",
        c: ["#ff4d6d","#ff0000","#00d4ff"][Math.floor(Math.random()*3)]
    }));

    function anim() {
        ctx.clearRect(0,0,canvas.width,canvas.height);
        items.forEach(p=>{
            ctx.fillStyle=p.c;
            ctx.font=p.s+"px Arial";
            ctx.fillText(p.t,p.x,p.y);
            p.y+=p.v;
            if(p.y>canvas.height) p.y=-20;
        });
        requestAnimationFrame(anim);
    }
    anim();
}
</script>

</body>
</html>








